# heat-management-system Specification

## Purpose

Defines heat generation, dissipation, and management rules for BattleMech units.

## Requirements

### Requirement: Heat Generation

The system SHALL track heat generated by weapons and movement.

#### Scenario: Weapon heat from actual data

- **WHEN** weapons are fired
- **THEN** heat generated SHALL equal the sum of actual weapon heat values from `IWeaponData`
- **AND** heat values SHALL be looked up from the weapon's data definition
- **AND** hardcoded heat values (e.g., `weapons.length * 10`) SHALL NOT be used

#### Scenario: Movement heat corrected

- **WHEN** a mech walks
- **THEN** walking SHALL generate 1 heat
- **WHEN** a mech runs
- **THEN** running SHALL generate 2 heat
- **WHEN** a mech jumps
- **THEN** jumping SHALL generate heat equal to `max(3, jumpMPUsed)`
- **AND** the hardcoded `Jump ? 1 : 0` SHALL NOT be used

#### Scenario: Alpha strike heat

- **WHEN** all weapons are fired simultaneously
- **THEN** alpha strike heat SHALL equal the sum of actual heat values from all weapons

### Requirement: Heat Dissipation

The system SHALL calculate heat dissipation from heat sinks.

#### Scenario: Heat sink dissipation from actual count

- **WHEN** calculating heat dissipation
- **THEN** single heat sinks SHALL dissipate 1 heat each
- **AND** double heat sinks SHALL dissipate 2 heat each
- **AND** total dissipation SHALL use the unit's actual heat sink count
- **AND** the hardcoded `baseHeatSinks = 10` SHALL NOT be used
- **AND** destroyed heat sinks SHALL be subtracted from the count

#### Scenario: Net heat calculation

- **WHEN** calculating net heat
- **THEN** net heat SHALL equal heat generated minus heat dissipated (including water cooling and minus destroyed heat sinks)

### Requirement: Heat Effects

Excess heat SHALL cause negative effects.

#### Scenario: Heat scale

- **WHEN** heat exceeds dissipation
- **THEN** movement penalties SHALL apply at thresholds
- **AND** shutdown risk SHALL increase with heat level

### Requirement: Registry-Based Heat Lookup

Heat calculation SHALL use equipment registry for weapon heat values.

#### Scenario: Equipment registry lookup for heat

- **WHEN** calculating heat from equipment
- **THEN** each equipment item SHALL be looked up in registry
- **AND** heat value SHALL be extracted from registry data
- **AND** items without heat property SHALL contribute 0 heat

#### Scenario: Registry not initialized

- **WHEN** equipment registry is not ready
- **THEN** heat profile SHALL return default values
- **AND** heat generated SHALL be 0 until registry loads
- **AND** heat dissipation SHALL still be calculated from heat sink count

### Requirement: Maximum Heat Display

The system SHALL calculate and display the maximum possible heat generation for UI purposes.

#### Scenario: Heat generated includes movement

- **WHEN** calculating heatGenerated for display
- **THEN** total SHALL include weapon heat plus worst-case movement heat
- **AND** movement heat = max(runningHeat, jumpingHeat)
- **AND** runningHeat = 2
- **AND** jumpingHeat = number of jump jets

#### Scenario: Running vs jumping heat selection

- **WHEN** mech has fewer than 3 jump jets
- **THEN** movement heat SHALL be 2 (running is worse)
- **AND** when mech has 3 or more jump jets
- **THEN** movement heat SHALL equal jump MP (jumping is worse)

#### Scenario: Alpha strike heat tracking

- **WHEN** calculating heat profile
- **THEN** alphaStrikeHeat SHALL track weapon-only heat separately
- **AND** heatGenerated SHALL include weapons + movement
- **AND** netHeat = heatGenerated - heatDissipated

#### Scenario: Heat profile with no weapons

- **WHEN** mech has no weapons and no jump jets
- **THEN** heatGenerated SHALL be 2 (running heat only)
- **AND** alphaStrikeHeat SHALL be 0

#### Scenario: Heat profile with 5 jump jets

- **WHEN** mech has 5 jump jets and no weapons
- **THEN** heatGenerated SHALL be 5 (jump heat > running heat)
- **AND** alphaStrikeHeat SHALL be 0

### Requirement: Water Cooling Bonus

Heat dissipation SHALL include water cooling bonuses when a unit is standing in water.

#### Scenario: Standing in water depth 1

- **WHEN** a unit is standing in water at depth 1 during the heat phase
- **THEN** heat dissipation SHALL be increased by 2 points

#### Scenario: Standing in water depth 2+

- **WHEN** a unit is standing in water at depth 2 or greater during the heat phase
- **THEN** heat dissipation SHALL be increased by 4 points

### Requirement: Engine Hit Heat

Each engine critical hit SHALL generate +5 additional heat per turn.

#### Scenario: One engine hit adds 5 heat

- **WHEN** a unit has 1 engine critical hit
- **THEN** the unit SHALL generate an additional 5 heat per turn
- **AND** this heat SHALL be added during the heat generation phase

#### Scenario: Two engine hits add 10 heat

- **WHEN** a unit has 2 engine critical hits
- **THEN** the unit SHALL generate an additional 10 heat per turn (cumulative)
