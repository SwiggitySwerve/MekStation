## 1. Foundation — Adapter, Engine, Infrastructure Fixes

- [ ] 1.1 Create CompendiumAdapter (`src/engine/adapters/CompendiumAdapter.ts`) that converts compendium unit data to IUnitGameState. Must map: armor per location, structure per location, weapons with damage/heat/range, movement points from engine rating, pilot skills (default 4/5). Support optional initialDamage parameter for campaign carry-forward. Uses `canonicalUnitService.getById(id)` for full unit data. Write unit tests for Atlas AS7-D, Locust LCT-1V, Hunchback HBK-4G. **Spec: game-engine § Compendium Unit Adapter**
- [ ] 1.2 Create GameEngine class (`src/engine/GameEngine.ts`) with two execution modes: `runToCompletion(config, playerUnits, opponentUnits)` returns completed IGameSession using BotPlayer for both sides; `createInteractiveSession(config, playerUnits, opponentUnits)` returns InteractiveSession with getState(), getAvailableActions(unitId), applyAction(action), advancePhase(), runAITurn(side), isGameOver(), getResult(). Must use existing combat utilities (damage.ts, toHit.ts, heat.ts, movement.ts), GameSession event system, GameOutcomeCalculator, and SeededRandom. Write tests: auto-resolve produces winner, damage varies (not SIMPLE_DAMAGE=5), interactive session cycles phases, AI turn executes. **Spec: game-engine § GameEngine Auto-Resolve Mode, GameEngine Interactive Mode, GameEngine Configuration**
- [ ] 1.3 Fix E2E store helper (`e2e/helpers/store.ts`) to use `window.__ZUSTAND_STORES__` instead of stale `window.__STORES__`. Verify with grep that no references to old name remain. Run smoke tests. **Spec: agent-autonomous-play § E2E Store Helper Correctness**
- [ ] 1.4 Add hex-level data-testid selectors to HexMapDisplay.tsx: `data-testid="hex-{q}-{r}"` on hex group elements, `data-testid="unit-token-{unitId}"` on unit tokens, `data-testid="hex-map-container"` on outermost wrapper. No visual changes. **Spec: tactical-map-interface § Hex-Level Test Selectors, agent-autonomous-play § Hex-Level Data-TestID Selectors**

## 2. Force Builder & Encounter Fixes

- [ ] 2.1 Wire force builder unit selector to compendium. Replace empty `availableUnits` array in `src/pages/gameplay/forces/[id].tsx` with UnitSearchService.search() calls. Build unit selector modal with: name search (fuzzy via MiniSearch), weight class filter, tech base filter, unit card display (name, weight, BV), pagination for 4,200+ units. On selection: assign unit to force slot. Include custom variants alongside canonical units. **Spec: force-management § Unit Selection from Compendium**
- [ ] 2.2 Fix encounter launch navigation in `src/pages/gameplay/encounters/[id].tsx`. Change `router.push('/gameplay/encounters')` to capture gameSessionId from launch API response and navigate to `/gameplay/games/${gameSessionId}`. Add loading state during launch. Add error toast if launch fails. **Spec: combat-resolution § Encounter Launch to Game Session**

## 3. Quick Play — Auto-Resolve Mode

- [ ] 3.1 Replace demo gameplay in QuickGamePlay.tsx with real auto-resolve. Bridge useQuickGameStore → CompendiumAdapter → GameEngine.runToCompletion() → useGameplayStore → navigate to /gameplay/games/{sessionId}. Remove demo banner and manual "Mark Destroyed" buttons. Add loading state during resolution. **Spec: quick-session § Quick Play Store Bridge, quick-session § Quick Game Entry (modified: Start battle offers mode selection)**
- [ ] 3.2 Build game results and completion page at `src/pages/gameplay/games/[id].tsx` (or results sub-route). Display: winner announcement (Victory/Defeat/Draw), battle statistics (turns, damage dealt/received, units destroyed), per-unit final status cards (intact/damaged/destroyed with armor %), key moments from KeyMomentDetector. Navigation buttons: Watch Replay, Play Again, Return to Encounters. **Spec: game-session-ui § Game Results Page**

## 4. Encounter-to-Game Flow

- [ ] 4.1 Wire complete encounter → game session flow. After encounter launch (task 2.2), game session page loads encounter config (forces, map, scenario template), converts units via CompendiumAdapter, initializes GameEngine. Show pre-battle screen with both forces listed (names, BV) and scenario template name. Offer "Auto-Resolve" and "Play Manually" options. Auto-resolve: run and show results. Play Manually: start interactive session. **Spec: game-session-ui § Pre-Battle Mode Selection, combat-resolution § GameEngine-Backed Combat Resolution**

## 5. Interactive Turn-by-Turn Mode

- [ ] 5.1 Build interactive game session UI on hex map. Wire HexMapDisplay click handlers to InteractiveSession: Movement phase — click unit shows valid destinations via overlay, click hex moves unit. Attack phase — click unit shows weapons panel, click opponent sets target with hit probability, Fire button resolves attack. Show phase indicator (Initiative/Movement/WeaponAttack/Heat/End), turn counter, selected unit panel (armor, weapons, heat, movement). AI opponent turn: call runAITurn(), show "Opponent's Turn" indicator. Victory/defeat screen on game end. **Spec: game-session-ui § Game Session Page — Interactive Mode, tactical-map-interface § Interactive Gameplay Integration**
- [ ] 5.2 Build AI-vs-AI spectator mode. Accessible from Quick Play ("Watch AI Battle") and encounters ("Simulate Battle"). Creates InteractiveSession where both sides use BotPlayer. Playback controls: Play/Pause, speed (1×/2×/4×), Step Forward — following useSharedReplayPlayer pattern. Unit tokens move on map, attack results displayed. Battle completes with normal results page. **Spec: game-session-ui § AI-vs-AI Spectator Mode, tactical-map-interface § AI-vs-AI Spectator Rendering**

## 6. Campaign MVP

- [ ] 6.1 Implement campaign roster assignment. Replace "coming soon" placeholder in campaign creation wizard roster step. Add unit selection from compendium (reuse unit selector from task 2.1). Allow pilot assignment to roster units. Wire to useCampaignStore forces sub-store. Display roster on campaign dashboard with unit name, pilot, and readiness status. Persist between sessions. **Spec: campaign-management § Campaign Roster Assignment**
- [ ] 6.2 Implement campaign mission generation. Add "Generate Mission" button to campaign dashboard. User selects roster units for deployment. Auto-generate opponent force using existing scenarioGenerator (OpFor scaled to selected units' BV). Create encounter in useEncounterStore linked to campaign with random scenario template. Navigate to encounter detail page. Track mission count in campaign store. **Spec: campaign-management § Campaign Mission Generation, scenario-generation § Scenario Output Applied to Encounter**
- [ ] 6.3 Implement campaign damage carry-forward. After campaign mission battle completes: read damage state from game result via DamageCalculator, write damage back to campaign forces store. Destroyed units marked as lost. Damaged units retain reduced armor for next mission (CompendiumAdapter receives initialDamage). Dashboard shows unit readiness: Ready/Damaged/Destroyed. **Spec: campaign-management § Campaign Damage Carry-Forward**
- [ ] 6.4 Wire complete campaign → battle → campaign loop. "Return to Campaign" button on results page (when game was campaign mission). Campaign dashboard updates after battle: mission count incremented, unit roster shows updated damage/readiness, mission history section shows outcome. Verify 3 consecutive missions complete without errors. **Spec: campaign-management § Campaign Battle Loop**

## 7. Agent Autonomy & E2E Tests

- [ ] 7.1 Create Playwright autonomous agent player (`e2e/helpers/agent-player.ts`). Methods: makeMovementDecision(gameState) — move toward nearest enemy; makeAttackDecision(gameState) — select highest-damage weapon, target most-damaged enemy; playTurn(page) — execute one full player turn; playGame(page) — loop until game over. Agent reads state from window.**ZUSTAND_STORES**.gameplay.getState(), acts via UI clicks on hex map and buttons. Must complete game in under 60 seconds. **Spec: agent-autonomous-play § Autonomous Agent Player Helper**
- [ ] 7.2 Write Quick Play flow E2E test (`e2e/quick-play.spec.ts`). Cover: navigate to Quick Play, select units from compendium, configure scenario, auto-resolve battle, verify results displayed, verify replay has events. Also test interactive flow. Tag @game @smoke. **Spec: agent-autonomous-play § Integration Test Suites (Quick Play)**
- [ ] 7.3 Write Encounter flow E2E test (`e2e/encounter-flow.spec.ts`). Cover: create force with compendium units, create encounter with scenario template, assign forces, launch encounter, verify game session created, auto-resolve, verify results. Tag @encounter @smoke. **Spec: agent-autonomous-play § Integration Test Suites (Encounter)**
- [ ] 7.4 Write Campaign flow E2E test (`e2e/campaign-flow.spec.ts`). Cover: create campaign, assign roster, generate mission, launch and auto-resolve, return to campaign, verify damage carry-forward, run second mission. Tag @campaign @smoke. **Spec: agent-autonomous-play § Integration Test Suites (Campaign)**
- [ ] 7.5 Write Agent autonomy E2E test (`e2e/agent-autonomy.spec.ts`). Cover: start interactive game, agent plays through entire game via agent-player helper, verify game reaches completion, verify 10+ game events generated, verify game completes in under 60 seconds. Tag @game @agent. **Spec: agent-autonomous-play § Integration Test Suites (Agent autonomy)**

## 8. Verification

- [ ] 8.1 Run `npm run verify:full` (typecheck + lint + format + test + build) and confirm all 18,000+ existing tests still pass. Fix any regressions introduced by this change. Confirm zero new LSP diagnostics errors in changed files.
- [ ] 8.2 Run all new E2E test suites: `npx playwright test --grep @smoke` and `npx playwright test --grep @agent`. All tests pass. Capture evidence screenshots to `.sisyphus/evidence/`.
